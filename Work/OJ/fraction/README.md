# 分数类

**我们定义分数的最简表示为**: 满足分子和分母的绝对值的最大公约数为 $1$ 的分数。

例如，$1/2$ , $-11/4514$ , $1919/810$ 都是最简表示，但 $2/4$ , $114/514$，$19198/10$ 不是最简表示。

现在，你需要完成一个基本的分数类，其需要满足以下的功能。

## 模板参数

我们用模板传入的类型存储分子和分母，保证传入的数字为有符号类型，且分母不为 $0$ 。请注意，传入的有符号类型的行为和 `int` 类型一致，但长度和最大范围是不确定的，取决于模板参数。

特别地，我们保证传入的模板参数可以用 `std::cout` 输出，且我们保证传入的模板参数可以进行四则运算(加减乘除)、取负、取模，以及比较运算、默认构造、拷贝构造、拷贝赋值以及部分类型转换。以下是一段程序演示我们的保证:

```C++
// 假设传入模板类型为 _Tp . 以下为合法代码

_Tp x = _Tp();  // 保证括号默认构造为 0。
_Tp y = 1;  // 可以从正整数构造。
_Tp z = x;  // 可以拷贝构造, 拷贝赋值, 移动构造, 移动赋值。

x < y;      // 可以比较 (所有比较运算都可以)。
x + y;      // 可以加 (包括 +=, 后面不再赘述)。
x - y;      // 可以减。
x * y;      // 可以乘。
x / y;      // 可以除。当 x 和 y 均为正时，保证是向下取整。
x % y;      // 可以取模，定义为 x - (x / y) * y。
-x;         // 可以取负。

std::cout << x; // 可以输出。

double y {x}; // 可以显式地从 _Tp 类型转换到 double 类型。
```

除此之外，我们对于模板参数**没有任何的额外保证**。例如，`int`, `__int128_t` 和 `int2048` 均合法。


## 构造函数

对于分数类，我们有以下几个最基本的要求:

1. 默认构造函数，默认分数值为 $0$ 。

```C++
fraction <int> f; // f = 0;
```

2. 可以用一个传入的模板类型的值构造一个分数类。此时分母为 $1$ ，分子为传入的值。

```C++
fraction <int> f = 3;               // f =  3;
fraction <long long> g = -1ll;      // g = -1;
```

3. 可以用两个传入的模板类型的值构造一个分数类。此时分母为第二个传入的值，分子为第一个传入的值。我们保证 **传入的第二个值不为 $0$** 。

```C++
fraction <int> f (6,12); // f = 1/2;
```

4. 拷贝构造和拷贝赋值函数，可以从其他分数类拷贝构造或拷贝赋值。

```C++
fraction <int> g; // g = 0;
fraction <int> f = g; // f = g = 0;
g = f = 2; // f = g = 2;
```

## 比较函数

我们要求实现比较运算符 `==` 和 `<` 。特别地，对于 `<` 比较运算符，我们保证在最简表示下，两个操作数的分子和分母这四个数字中，两两的乘积都不会超过 **传入模板类型的最大范围的一半** 。例如，传入的模板参数为 `int` 类型，当最简分数 `a/b` 和 `c/d` 进行比较，那么 `a*b, a*c, a*d, b*c, b*d, c*d ` 这六个数均不会超过 int 范围的一半，即绝对值不会超过 $2^{30} - 1$ 。

```C++
fraction <int> a = 1, b = 2;
std::cout << int(a == b) << std::endl; // 输出 0
std::cout << int(a <  b) << std::endl; // 输出 1
```

## 四则运算

加减乘除的表现和正常的数学运算一致。额外的，我们要求实现取倒数操作，用运算符 `~` 表示。

我们保证在最简表示下，两个操作数的分子和分母这四个数字中，两两之间的乘积都不会超过 **传入模板类型的最大范围的一半** 。

特别地，当四则运算 (包括取倒数) 导致结果的分母为 $0$ ，需要抛出异常 `divided_by_zero` 。其定义在下发文件 `frac.h` 中一并给出。

```C++
fraction <int> a = 1, b = 0;
try {
    a /= b;
} catch(const std::exception &err) {
    // 此处应该输出 Divided by zero!
    std::cout << err.what(); 
}
```

## 输出函数

输出运算符的输出格式为 `分子/分母`，且为最简表示。特别地，对于 $0$ ，要求输出为 `0/1` 。对于负数，要求负号出现在分子前面。例如，$-\frac{1}{2}$ 应该输出为 `-1/2` 。

```C++
fraction <int> a = 1;
a /= -2;
std::cout << a << std::endl; // 输出 -1/2
```

## 类型转换

我们的分数类需要支持转化为 `double` 类型。在最简表示下，你不用担心精度问题。

```C++
fraction <int> a (2,6);
double b = a; // b = 1.0 / 3
```

我们的分数类也需要支持转化为 `bool` 类型，当且仅当分数的值为 $0$ 时，转化为 `false` ，否则转化为 `true` 。

```C++
fraction <int> a; // 默认初始化为 0
if (a) {
    std::cout << "a is not zero!" << std::endl;
} else {
    std::cout << "a is zero!" << std::endl; // 输出 a is zero!
}
```

## 其他说明

我们保证计算过程中，最简表示法的分数一定不会超过模板参数 `_Tp` 的最大范围。换句话说，**如果你用最简表示的分数进行四则运算，那么你不用担心整数的溢出问题。**

同时，我们对于分数类的实现几乎没有性能要求，唯一的性能瓶颈可能在于求最大公约数 (我们会在下面给出模板)。如果依然出现 `TLE` 的问题，说明你的实现可能存在问题。

需要特别注意的是，**即使你没有实现 `fraction` 的部分函数，你也依然需要保留这些函数的声明，否则将无法通过编译**，即使这个测试点没有用到这些函数。

如果你提交的代码中全部 `CE` ，并且具体报错信息里面提示 `undefined reference to 'Some_of_your_member_functions_are_missing()'` ，说明你提交的代码里缺少了某些成员函数的声明。请与下发模板文件进行比对，补全缺少的成员函数的声明，再次提交即可。

如果你正确地保留了声明，但是没有实现部分功能，那么你只会在对应的测试点出现 `CE` (报错信息是 `undefined reference to xxx(具体函数)`) ，其他没有用到这些功能的测试点不会受到影响。

模板在下发文件 `frac.h` 中。你只需要补全模板类 `fraction` 的实现即可。

## 提示

将两个非负整数化为最简分数，只需要求出两个非负整数的最大公约数，然后分子分母同时除以最大公约数即可。下面给出一个求最大公约数的模板函数:

```C++
/**
 * @brief 求出两个数的最大公约数
 * @param x 第一个数
 * @param y 第二个数
 * @return 两个数的最大公约数
 * @note 传入的两个数是非负整数时保证正确，否则行为未定义。
 * 该函数的时间复杂度为 O(log(xy))，正确使用不会存在性能问题。
*/
template <typename _Tp>
inline _Tp gcd(_Tp x, _Tp y) {
    while (y) {
        x %= y;
        std::swap(x, y);
    } return x;
}
```

## 数据范围

| Subtask No. | Testcases No.  | 前置Subtask  | 额外考察的内容                                  | 分数   |
| ----------- | -------------- | ------------ | ----------------------------------------------- | ------ |
| $1$       | $1,2$        | **无** | 考察所有构造函数、赋值操作、输出重载            | $10$ |
| $2$       | $3,4$        | $1$        | 考察单目运算符 `~` (取倒数) 和 `-` (取负数) | $10$ |
| $3$       | $5,6,7,8$    | $1$        | 考察加法和减法 `+,-,+=,-=`                    | $15$ |
| $4$       | $9,10,11,12$ | $1$        | 考察乘法和除法 `*,/,*=,/=`                    | $15$ |
| $5$       | $13,14$      | $1$        | 考察类型转换运算符 `double` 和 `bool`       | $10$ |
| $6$       | $15,16$      | $1$        | 考察比较运算符 `<, ==`                        | $10$ |
| $7$       | $17,18$      | $2,3,4$    | 无 (四则运算测试，含异常处理)                   | $15$ |
| $8$       | $19,20$      | $5,6,7$    | 无 (综合压力测试，含异常处理)                   | $15$ |
