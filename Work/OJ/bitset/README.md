# ACMOJ [2069](https://acm.sjtu.edu.cn/OnlineJudge/problem/2069) Prof. Dark 的 bitset

首先道个歉!

首先道个歉!

首先道个歉! 题目太暴了，确实考察了不少的位运算知识，如果不太熟悉位运算的同学可能会比较难受 sorry。

## 解析

没啥好解析的，这题其实本质上考的就是位运算 + STL 以及边界情况的处理。std 代码可以看 [ans.h](ans.h) ，当然你可以有自己的实现。

首先，需要知道位运算的基本操作。对于单一 bit, `0 & x = 0` , `0 | x = x` , `0 ^ x = x` , `1 & x = x` , `1 | x = 1` , `1 ^ x = 1 - x` 。同时，对于那些无符号的正整数，左移以后最低位会补 $0$ ，右移以后最高位会补 $0$ 。

然后如何把最低 $n$ 位设置为 $1$ ，这也是基本操作，只需要 `(1 << n) - 1` 即可，正确性比较显然，建议各位自行推导一下。

这些都是非常基本的知识，程序设计期末考都会考的，如果不熟悉的话可以去看看 [cppreference](https://en.cppreference.com/w/cpp/language/operator_arithmetic) 。当然我更建议你新建一个 .cpp 文件写着试试看，这样会更加有感觉。

至于为什么说考察 STL ，那是因为本题左移和右移操作在 `vector` 头尾进行操作都是有成员函数支持的。`vector` 成员函数的实现几乎一定是比你自己写的要快的，所以能用则用。那 `vector` 有这么多成员函数，到底如何去学呢？除了 cppreference，还有一个很好的办法就是靠代码补全。如果你用 vscode/CLion ，你可以声明一个 `vector` 的容器，然后输入 `.` ，一般来说代码提示会给你直接提示出那些成员函数。通过注释，再结合 cppref ，你就可以很快的学会 `vector` 的用法了。当然，一定要上手写写看，才清楚到底表现如何。

```C++
vector <int> test;
test. //输入点，然后停住，这时候代码补全就会给你提示 vector 的成员函数
```

测试点在 2069 文件内，可以本地自己测，但不要面向数据编程。

## 实现

笔者的实现如下: 用 `uint64_t (unsigned long long)` 压位，然后每 $64$ 个 $01$ 位压缩到一个 `uint64` 。对于每个 bit ，按照从低到高位的顺序存储在 `uint64` 里。比如当 `size()` 为 $1$ 的时候，唯一的位是 `uint64` 的最低位，即要么是 $0$ ，要么是 $1$ 。

对于额外溢出的 bit (即无法对齐到 64 倍数剩下的) ，笔者保证每个操作后，最后的那个 `uint64` 的最高的、没用到的那些 bit 全部设为 $0$ 。这自然是取决于你自己的实现。

需要注意，那些额外溢出的 bit 可能会影响 `all` 和 `none` 等函数的正确性，这意味着你需要特别地处理边界。

代码可以看 [ans.h](ans.h) ，不懂的随时来问。当然最好还是自己想明白了独立实现，你也可以有自己的架构。

## 剩下的话

本题本来是要作为期末机考的，作为一道送分(?)题。难度的话我个人觉得中等，虽然代码量略大，但很多函数都是可以 copy paste 的，所以实际上只要熟悉点位运算，难度都不算大。

然后题目的灵感来源于 `vector <bool>` ，一个诡异的实现，具体请看 [cppref](https://en.cppreference.com/w/cpp/container/vector_bool) 。还有一个来源就是 boost (一个第三方库，基本就是标准委员会那帮人管的) 的 `dynamic_bitset` 。

位运算真的是一个程序员最基本的素养，而作为 C++ 程序员，熟练掌握 STL 也是必不可少的。感觉各位对于程序设计的重视程度还是不太够，总之还是希望大家多思考多学习多积累，不要只是为了考试而学习。知识是一点点积累的，要 "connect the dots" 。

最后再道个歉，这个题作为平时机考题确实太毒瘤了点，我本来心理期望得分是 $30 + 15$ 左右，但实际情况比这个要糟糕......  如果有不懂的及时来问，以上内容基本完全可以搬到期末考试 (机考/笔试) 中的哦。

**以上**

## 夹带私货

如果你写完了且有空，试着看看下面几篇文章。

[Dark 早年看过的一篇讲位运算魔法的文章](https://graphics.stanford.edu/~seander/bithacks.html)

[现代 C++ ? 真正的 C++ ! (选看)](https://cntransgroup.github.io/EffectiveModernCppChinese/)

[(私货) 右值是什么(不严谨版) & 我们为什么要传引用](https://darksharpness.github.io/optimize2/)
